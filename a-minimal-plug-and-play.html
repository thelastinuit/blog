<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge;chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" href="/favicon.ico">
        <title>a louise</title>
        <style>
            html, body {
                margin: 0;
                padding: 0;
                width: 100%;
                height: 100%;
                display: table;
            }

            .sidebar {
                margin-top: 1ch;
            }

            .content {
                display: flex;
                margin: 0 auto;
                max-width: 80ch;
                align-items: center;
                justify-content: center;
            }
            h3 {
                margin-top: 0;
                margin-bottom: 0;
            }
            @media only screen and (max-width: 375px) {
                .content {
                    font-size: 0.85rem;
                    width: 100%;
                }
            }
            a:link,
            a:visited,
            a:hover,
            a:active {
                text-decoration:none;
                color:#333
            }

            .flex-column { flex-direction: column; }
            .inline-grid { display: inline-grid;}
            div.language-tag {
                display: block;
                float: left;
                background: #ffd1ac;
                color: #a04100;
                padding: 0.2em 0.5em;
                font-weight: bold;
                font-size: 1rem;
                border-radius: 0 0 8px 0;
            }
            pre {
                background-color: #fffcf9;
                border-radius: 4px;
                padding: 0;
                border: 1px solid #ffd1ac;
                position: relative;
            }
            article p { max-width: 80ch;}
            div.language-tag + .code-container { clear: both; }
            pre .code-container {
                padding: 0.8rem;
                line-height: 1.1;
            }
        </style>
        <link rel="stylesheet" href="style.css?nocache=true">
    </head>
    <body>
        <div class="sidebar">
            <div class="content">
                <article class="inline-grid">
                    <img src="otnot.png" style="width:75%;margin: 0 auto;"/>

                    <h3 style="margin-top: 0; margin-bottom: 0;">
                        a<br>
                        |&gt; minimal<br/>
                        |&gt; plug && play
                    </h3>
                    
                    <blockquote>
                        Giving birth and nourishing,<br/>
                        having without possessing,<br/>
                        acting with no expectations,<br/>
                        leading and not trying to control:<br/>
                        this is the supreme virtue.
                    </blockquote>
                    
                    <p>
                        i enjoy make things. it doesn't matter if those things are already created, designed or envisioned. in other words, i enjoy the process of making things.
                        so, let's try to use <a href="https://www.phoenixframework.org/">Phoenix</a> to create a minimal web server.
                    <p>
                    <p>
                        let's start by defining the dependencies:
                    </p>
                    <pre><div class="language-tag">Elixir</div><div class="code-container"><code><span style="color: #880000">Mix</span><span style="color: #666666">.</span>install([
  {<span style="color: #19177C">:plug_cowboy</span>, <span style="color: #BA2121">&quot;~&gt; 2.5&quot;</span>},
  {<span style="color: #19177C">:jason</span>, <span style="color: #BA2121">&quot;~&gt; 1.0&quot;</span>},
  {<span style="color: #19177C">:phoenix</span>, <span style="color: #BA2121">&quot;~&gt; 1.6&quot;</span>}
])
                    </code></div></pre>
                    <p>that piece of code can be in a file, say <em>web_server.exs</em>. let's take it for a spin by running it: 
                    <pre><div class="language-tag">Bash</div><div class="code-container"><code>$ elixir web_server.exs</code></div></pre>
                    <p>the output should be something similar to the following</p>
                    <pre><div class="language-tag">Bash</div><div class="code-container"><code>Resolving Hex dependencies...
Dependency resolution completed:
New:
  cowboy 2.9.0
  cowboy_telemetry 0.4.0
  cowlib 2.11.0
  jason 1.3.0
  mime 2.0.2
  phoenix 1.6.5
  phoenix_pubsub 2.0.0
  phoenix_view 1.0.0
  plug 1.12.1
  plug_cowboy 2.5.2
  plug_crypto 1.2.2
  ranch 1.8.0
  telemetry 1.0.0
* Getting plug_cowboy <span style="color: #666666">(</span>Hex package<span style="color: #666666">)</span>
* Getting jason <span style="color: #666666">(</span>Hex package<span style="color: #666666">)</span>
* Getting phoenix <span style="color: #666666">(</span>Hex package<span style="color: #666666">)</span>
* Getting phoenix_pubsub <span style="color: #666666">(</span>Hex package<span style="color: #666666">)</span>
* Getting phoenix_view <span style="color: #666666">(</span>Hex package<span style="color: #666666">)</span>
* Getting plug <span style="color: #666666">(</span>Hex package<span style="color: #666666">)</span>
* Getting plug_crypto <span style="color: #666666">(</span>Hex package<span style="color: #666666">)</span>
* Getting telemetry <span style="color: #666666">(</span>Hex package<span style="color: #666666">)</span>
* Getting mime <span style="color: #666666">(</span>Hex package<span style="color: #666666">)</span>
* Getting cowboy <span style="color: #666666">(</span>Hex package<span style="color: #666666">)</span>
* Getting cowboy_telemetry <span style="color: #666666">(</span>Hex package<span style="color: #666666">)</span>
* Getting cowlib <span style="color: #666666">(</span>Hex package<span style="color: #666666">)</span>
* Getting ranch <span style="color: #666666">(</span>Hex package<span style="color: #666666">)</span>
<span style="color: #666666">==</span>&gt; phoenix_view
Compiling 5 files <span style="color: #666666">(</span>.ex<span style="color: #666666">)</span>
Generated phoenix_view <span style="color: #19177C">app</span>
<span style="color: #666666">===</span>&gt; Analyzing applications...
<span style="color: #666666">===</span>&gt; Compiling <span style="color: #19177C">ranch</span>
<span style="color: #666666">===</span>&gt; Analyzing applications...
<span style="color: #666666">===</span>&gt; Compiling <span style="color: #19177C">telemetry</span>
<span style="color: #666666">==</span>&gt; jason
Compiling 10 files <span style="color: #666666">(</span>.ex<span style="color: #666666">)</span>
Generated jason <span style="color: #19177C">app</span>
<span style="color: #666666">==</span>&gt; phoenix_pubsub
Compiling 11 files <span style="color: #666666">(</span>.ex<span style="color: #666666">)</span>
Generated phoenix_pubsub <span style="color: #19177C">app</span>
<span style="color: #666666">===</span>&gt; Analyzing applications...
<span style="color: #666666">===</span>&gt; Compiling <span style="color: #19177C">cowlib</span>
<span style="color: #666666">===</span>&gt; Analyzing applications...
<span style="color: #666666">===</span>&gt; Compiling <span style="color: #19177C">cowboy</span>
<span style="color: #666666">===</span>&gt; Analyzing applications...
<span style="color: #666666">===</span>&gt; Compiling <span style="color: #19177C">cowboy_telemetry</span>
<span style="color: #666666">==</span>&gt; mime
Compiling 1 file <span style="color: #666666">(</span>.ex<span style="color: #666666">)</span>
Generated mime <span style="color: #19177C">app</span>
<span style="color: #666666">==</span>&gt; plug_crypto
Compiling 5 files <span style="color: #666666">(</span>.ex<span style="color: #666666">)</span>
Generated plug_crypto <span style="color: #19177C">app</span>
<span style="color: #666666">==</span>&gt; plug
Compiling 1 file <span style="color: #666666">(</span>.erl<span style="color: #666666">)</span>
Compiling 41 files <span style="color: #666666">(</span>.ex<span style="color: #666666">)</span>
Generated plug <span style="color: #19177C">app</span>
<span style="color: #666666">==</span>&gt; plug_cowboy
Compiling 5 files <span style="color: #666666">(</span>.ex<span style="color: #666666">)</span>
Generated plug_cowboy <span style="color: #19177C">app</span>
<span style="color: #666666">==</span>&gt; phoenix
Compiling 69 files <span style="color: #666666">(</span>.ex<span style="color: #666666">)</span>
Generated phoenix app</code></div></pre>
                    <p>if so, we are good to go. next, we need an endpoint. let's add a phoenix endpoint:</p>
                    <pre><div class="language-tag">Elixir</div><div class="code-container"><code><span style="color: #008000; font-weight: bold">defmodule</span> <span style="color: #880000">WebServer</span><span style="color: #666666">.</span><span style="color: #880000">Endpoint</span> <span style="color: #008000; font-weight: bold">do</span>
<span style="color: #008000; font-weight: bold">  use</span> <span style="color: #880000">Phoenix</span><span style="color: #666666">.</span><span style="color: #880000">Endpoint</span>, <span style="color: #19177C">otp_app:</span> <span style="color: #19177C">:web_server</span>
  
  plug <span style="color: #19177C">:render</span>

  <span style="color: #008000; font-weight: bold">def</span> render(conn, _opts) <span style="color: #008000; font-weight: bold">do</span>
<span style="color: #008000; font-weight: bold">    </span><span style="color: #880000">Plug</span><span style="color: #666666">.</span><span style="color: #880000">Conn</span><span style="color: #666666">.</span>send_resp(conn, <span style="color: #666666">200</span>, <span style="color: #BA2121">&quot;Goodbye, World!&quot;</span>)
  <span style="color: #008000; font-weight: bold">end</span>
<span style="color: #008000; font-weight: bold">end</span></code></div></pre>
                    <p>we are almost done. we need to tell our supervisor to use our endpoint:</p>
                    <pre><div class="language-tag">Elixir</div><div class="code-container"><code>{<span style="color: #19177C">:ok</span>, _} <span style="color: #666666">=</span> <span style="color: #880000">Supervisor</span><span style="color: #666666">.</span>start_link([<span style="color: #880000">SamplePhoenix</span><span style="color: #666666">.</span><span style="color: #880000">Endpoint</span>], <span style="color: #19177C">strategy:</span> <span style="color: #19177C">:one_for_one</span>)
<span style="color: #880000">Process</span><span style="color: #666666">.</span>sleep(<span style="color: #19177C">:infinity</span>)</code></div></pre>
                    <p>if you run the escript again, you will notice that all is fine. but wait... to which port do i test the connection, right? ok, let's add some settings to our web server:</p>
                    <pre><div class="language-tag">Elixir</div><div class="code-container"><code><span style="color: #880000">Application</span><span style="color: #666666">.</span>put_env(<span style="color: #19177C">:web_server</span>, <span style="color: #880000">WebServer</span><span style="color: #666666">.</span><span style="color: #880000">Endpoint</span>, [
  <span style="color: #19177C">http:</span> [<span style="color: #19177C">ip:</span> {<span style="color: #666666">0</span>, <span style="color: #666666">0</span>, <span style="color: #666666">0</span>, <span style="color: #666666">0</span>}, <span style="color: #19177C">port:</span> <span style="color: #666666">4000</span>],
  <span style="color: #19177C">server:</span> <span style="color: #880000">true</span>,
  <span style="color: #19177C">secret_key_base:</span> <span style="color: #BA2121">&quot;unh4ck4bl3&quot;</span>
])</code></div></pre>
                    <p>now if you try again in your browser at <em>http://0.0.0.0:4000</em> you should see <b>Goodbye, World!</b></p>
                    <p>you probably see some warnings related to JSON parsing. you can fix that by adding:</p>
                    <pre><div class="language-tag">Elixir</div><div class="code-container"><code><span style="color: #880000">Application</span><span style="color: #666666">.</span>put_env(<span style="color: #19177C">:phoenix</span>, <span style="color: #19177C">:json_library</span>, <span style="color: #880000">Jason</span>)</code></div></pre>
                    <p>and we are done! a super simple web server. as you probably know, you can more phoenix stuff like <em>Phoenix.Router</em> or <em>Phoenix.Controller</em>, you know, grow <b>organically</b>.</p>
                </article>
            </div>
            <div class="content flex-column">
                <br>
                <p>—</p>
                <br>
                <div>
                    <a href="/" alt="to home">to go back</a>
                </div>
            </div>
        </div>
    </body>
</html>
